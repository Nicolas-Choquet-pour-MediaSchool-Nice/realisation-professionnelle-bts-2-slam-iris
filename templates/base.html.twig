<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{% block title %}Bienvenue!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        <style>
            :root {
                color-scheme: light dark;
                --primary: #007bff;
                --primary-hover: #0056b3;
                --bg-light: #ffffff;
                --border-color: #ddd;
                --text-main: #333;
                --text-muted: #666;
                --white: #fff;
                --danger: #dc3545;
                --success: #28a745;
                --nav-bg: #fff;
                --card-bg: #fff;
                --table-border: #eee;
                --dropdown-bg: #f9f9f9;
                --dropdown-hover: #f1f1f1;
                --badge-light-bg: #e2e3e5;
                --badge-light-text: #383d41;
                --badge-primary-bg: #cce5ff;
                --badge-primary-text: #004085;
                --badge-success-bg: #d4edda;
                --badge-success-text: #155724;
                --badge-danger-bg: #f8d7da;
                --badge-danger-text: #721c24;
                --card-shadow: rgba(0,0,0,0.1);
                --dropdown-shadow: rgba(0,0,0,0.1);
            }

            @media (prefers-color-scheme: dark) {
                :root {
                    --bg-light: #0f111a;
                    --border-color: #30363d;
                    --text-main: #f0f6fc;
                    --text-muted: #ffffff;
                    --white: #161b22;
                    --nav-bg: #161b22;
                    --card-bg: #161b22;
                    --table-border: #30363d;
                    --dropdown-bg: #1c2128;
                    --dropdown-hover: #30363d;
                    --badge-light-bg: #30363d;
                    --badge-light-text: #f0f6fc;
                    --badge-primary-bg: #1f6feb;
                    --badge-primary-text: #ffffff;
                    --badge-success-bg: #238636;
                    --badge-success-text: #ffffff;
                    --badge-danger-bg: #da3633;
                    --badge-danger-text: #ffffff;
                    --card-shadow: rgba(0,0,0,0.3);
                    --dropdown-shadow: rgba(0,0,0,0.5);
                    --primary: #58a6ff;
                    --success: #3fb950;
                    --danger: #f85149;
                }
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                color: var(--text-main);
                background-color: var(--bg-light);
            }

            nav {
                background-color: var(--nav-bg);
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                padding: 0 40px;
                align-items: center;
                height: 70px;
                box-sizing: border-box;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                position: sticky;
                top: 0;
                z-index: 1001;
            }

            .nav-brand {
                font-weight: 800;
                font-size: 1.4rem;
                color: var(--primary);
                text-decoration: none;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .nav-brand svg {
                width: 32px;
                height: 32px;
                fill: light-dark(black, white);
            }

            nav section {
                display: flex;
                align-items: center;
                gap: 5px;
            }

            nav a {
                text-decoration: none;
                color: var(--text-main);
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 500;
                transition: all 0.2s ease;
                font-size: 0.95rem;
            }

            nav a:hover {
                background-color: var(--dropdown-hover);
                color: var(--primary);
            }

            nav a.active {
                background-color: var(--badge-primary-bg);
                color: var(--primary);
            }

            .user-menu {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 6px 12px;
                border-radius: 50px;
                background-color: var(--dropdown-bg);
                border: 1px solid var(--border-color);
                transition: all 0.2s ease;
                cursor: pointer;
                max-width: 100px;
            }

            @media screen and (min-width: 600px) {
                .user-menu {
                    max-width: unset;
                }
            }

            .user-menu:hover {
                border-color: var(--primary);
                box-shadow: 0 2px 8px var(--dropdown-shadow);
            }

            .user-avatar {
                display: none;
                width: 32px;
                height: 32px;
                background-color: var(--primary);
                color: white;
                border-radius: 50%;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 0.8rem;
            }

            @media screen and (min-width: 600px) {
                .user-avatar {
                    display: flex;
                }
            }

            .user-info {
                display: flex;
                flex-direction: column;
                line-height: 1.2;
                overflow: hidden;
            }

            .user-name {
                font-size: 0.9rem;
                font-weight: 600;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 150px;
            }

            .user-role {
                font-size: 0.7rem;
                color: var(--text-muted);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 150px;
            }

            .container {
                max-width: 1200px;
                margin: 20px auto;
                padding: 0 20px;
            }

            .card {
                background: var(--card-bg);
                border-radius: 8px;
                box-shadow: 0 2px 10px var(--card-shadow);
                padding: 20px;
                margin-bottom: 20px;
            }

            .header-section {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            h1, h2, h3 {
                margin-top: 0;
            }

            .btn {
                display: inline-block;
                padding: 8px 16px;
                border-radius: 4px;
                text-decoration: none;
                cursor: pointer;
                border: none;
                font-size: 14px;
                transition: background 0.2s;
            }

            .btn-primary { background-color: var(--primary); color: white; }
            .btn-primary:hover { background-color: var(--primary-hover); }

            .btn-outline { border: 1px solid var(--primary); color: var(--primary); background: transparent; }
            .btn-outline:hover { background-color: var(--primary); color: white; }

            .btn-danger { background-color: var(--danger); color: white; }
            .btn-danger:hover { background-color: #c82333; }

            .table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }

            .table th, .table td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid var(--table-border);
            }

            .table th {
                font-weight: bold;
                color: var(--text-muted);
                text-transform: uppercase;
                font-size: 0.85em;
            }

            .badge {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.8em;
                font-weight: bold;
            }

            .badge-light { background-color: var(--badge-light-bg); color: var(--badge-light-text); }
            .badge-primary { background-color: var(--badge-primary-bg); color: var(--badge-primary-text); }
            .badge-success { background-color: var(--badge-success-bg); color: var(--badge-success-text); }
            .badge-danger { background-color: var(--badge-danger-bg); color: var(--badge-danger-text); }

            .actions-cell {
                display: flex;
                gap: 8px;
            }

            .alert {
                padding: 12px 20px;
                border-radius: 8px;
                margin-bottom: 20px;
                width: 100%;
                box-sizing: border-box;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 4px 12px var(--card-shadow);
                animation: slideIn 0.3s ease-out;
                border-left: 5px solid transparent;
                position: relative;
            }

            @keyframes slideIn {
                from { transform: translateY(-20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }

            .alert-success {
                background-color: var(--badge-success-bg);
                border: 1px solid var(--success);
                border-left-color: var(--success);
                color: var(--badge-success-text);
            }
            .alert-danger {
                background-color: var(--badge-danger-bg);
                border: 1px solid var(--danger);
                border-left-color: var(--danger);
                color: var(--badge-danger-text);
            }
            .alert-warning {
                background-color: #fff3cd;
                border: 1px solid #ffeeba;
                border-left-color: #856404;
                color: #856404;
            }
            .alert-info {
                background-color: var(--badge-primary-bg);
                border: 1px solid var(--primary);
                border-left-color: var(--primary);
                color: var(--badge-primary-text);
            }

            .alert span {
                flex-grow: 1;
                font-weight: 500;
            }

            .alert-close {
                background: none;
                border: none;
                color: inherit;
                cursor: pointer;
                font-size: 1.2rem;
                padding: 0;
                margin-left: 10px;
                line-height: 1;
                opacity: 0.5;
                transition: opacity 0.2s;
            }

            .alert-close:hover {
                opacity: 1;
            }

            .flash-container {
                position: sticky;
                top: 80px;
                z-index: 1000;
                width: 100%;
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
                box-sizing: border-box;
            }

            /* Form styles */
            .form-group {
                margin-bottom: 15px;
            }

            .invalid-feedback {
                color: var(--danger);
                font-size: 0.85rem;
                margin-top: 4px;
                display: block;
            }

            form input.is-invalid, form select.is-invalid, form textarea.is-invalid {
                border-color: var(--danger);
            }

            form input.is-invalid:focus, form select.is-invalid:focus, form textarea.is-invalid:focus {
                box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
            }

            label {
                display: block;
                margin-bottom: 5px;
                font-weight: 500;
                color: var(--text-muted);
            }

            .form-control {
                width: 100%;
                padding: 10px 12px;
                font-size: 14px;
                line-height: 1.5;
                color: var(--text-main);
                background-color: var(--white);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                box-sizing: border-box;
                transition: border-color 0.15s ease-in-out;
            }

            .form-control:focus {
                border-color: var(--primary);
                outline: 0;
                box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
            }

            .checkbox-group {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 20px;
                cursor: pointer;
            }

            .checkbox-group input {
                cursor: pointer;
            }

            .checkbox-group label {
                margin-bottom: 0;
                cursor: pointer;
            }

            /* Layout utilities */
            .text-center { text-align: center; }
            .mt-3 { margin-top: 1rem; }
            .mb-3 { margin-bottom: 1rem; }
            .text-muted { color: var(--text-muted); }

            .auth-container {
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: calc(100vh - 100px);
                padding: 20px;
            }

            .auth-card {
                width: 100%;
                max-width: 400px;
            }

            .dropdown { position: relative; display: inline-block; width: max-content; }

            /* Symfony Form Overrides */
            form > div {
                margin-bottom: 15px;
            }
            form input[type="text"],
            form input[type="email"],
            form input[type="password"],
            form input[type="number"],
            form select,
            form textarea {
                width: 100%;
                padding: 10px 12px;
                font-size: 14px;
                line-height: 1.5;
                color: var(--text-main);
                background-color: var(--white);
                border: 1px solid var(--border-color);
                border-radius: 4px;
                box-sizing: border-box;
                transition: border-color 0.15s ease-in-out;
            }
            form input:focus, form select:focus, form textarea:focus {
                border-color: var(--primary);
                outline: 0;
            }
            form label {
                display: block;
                margin-bottom: 5px;
                font-weight: 500;
                color: var(--text-muted);
            }
            .dropbtn { background-color: transparent; border: none; cursor: pointer; font-size: 16px; display: flex; align-items: center; }
            .dropdown-content {
                display: none;
                position: absolute;
                right: 0;
                top: 100%;
                background-color: var(--dropdown-bg);
                min-width: 200px;
                box-shadow: 0 10px 25px var(--dropdown-shadow);
                z-index: 1002;
                border-radius: 12px;
                border: 1px solid var(--border-color);
                padding: 8px;
                color: var(--text-main);
            }
            .dropdown-content::before {
                content: '';
                position: absolute;
                top: -10px;
                left: 0;
                right: 0;
                height: 10px;
            }
            .dropdown-content {
                margin-top: 8px;
            }
            .dropdown-content a {
                color: var(--text-main);
                padding: 10px 12px;
                text-decoration: none;
                display: block;
                border-radius: 8px;
                transition: background 0.2s;
            }
            .dropdown-content a:hover {
                background-color: var(--dropdown-hover);
                color: var(--primary);
            }
            .dropdown-user-info {
                padding: 10px 12px;
                border-bottom: 1px solid var(--border-color);
                margin-bottom: 5px;
                overflow: hidden;
            }
            .dropdown-label {
                font-size: 0.8rem;
                color: var(--text-muted);
            }
            .dropdown-email {
                font-weight: 600;
                font-size: 0.9rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                color: var(--text-main);
            }
            .dropdown:hover .dropdown-content { display: block; }

        </style>
        {% block stylesheets %}
        {% endblock %}

        {% block javascripts %}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
        {% endblock %}
    </head>
    {% set currentPath = path(app.request.attributes.get('_route'),
        app.request.attributes.get('_route_params')) %}
    {% if isAdmin is not defined %}
        {% set isAdmin = false %}
    {% endif %}
    {% if isCoordinator is not defined %}
        {% set isCoordinator = false %}
    {% endif %}
    <body>
        {% if user is defined %}
        <nav>
            <section>
                <a href="{{ path('app_index') }}" class="nav-brand">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-7 5h5v5h-5v-5z"/>
                    </svg>
                </a>
                {% if isAdmin or isCoordinator %}
                <a
                    href="{{ path('app_dashboard') }}"
                    class="{% if currentPath starts with path('app_dashboard') %}active{% endif %}"
                >Dashboard</a>
                {% endif %}
                <a
                    href="{{ path('app_booking') }}"
                    class="{% if currentPath === path('app_booking') %}active{% endif %}"
                >Réserver</a>
            </section>

            <section>
                <div class="dropdown">
                    <div class="user-menu dropbtn">
                        <div class="user-avatar">
                            {{ user.firstname|first|upper }}{{ user.lastname|first|upper }}
                        </div>
                        <div class="user-info">
                            <span class="user-name">{{ user.firstname }} {{ user.lastname }}</span>
                            <span class="user-role">
                                {% if isAdmin %}Admin{% elseif isCoordinator %}Coordinateur{% else %}Étudiant{% endif %}
                            </span>
                        </div>
                        <span style="font-size: 0.7em; margin-left: 5px; opacity: 0.5;">▼</span>
                    </div>
                    <div class="dropdown-content">
                        <div class="dropdown-user-info">
                            <div class="dropdown-label">Connecté en tant que</div>
                            <div class="dropdown-email">{{ user.email }}</div>
                        </div>
                        <a href="{{ logout_url() }}">
                            <span style="display: flex; align-items: center; gap: 8px;">
                                <svg style="width: 18px; height: 18px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                </svg>
                                Déconnexion
                            </span>
                        </a>
                    </div>
                </div>
            </section>
        </nav>
        {% endif %}
        <div class="flash-container">
            {% for label, messages in app.flashes %}
                {% for message in messages %}
                    <div class="alert alert-{{ label == 'error' ? 'danger' : label }}">
                        <span>{{ message }}</span>
                        <button type="button" class="alert-close" onclick="this.parentElement.remove()">&times;</button>
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
        {% block body %}{% endblock %}
    </body>
</html>
